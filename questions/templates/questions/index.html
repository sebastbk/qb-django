{% extends "questions/base.html" %}

{% block css %}
{{ block.super }}
<style>
.rounded-0-i {
  border-radius: 0 !important;
}
.link-unstyled {
  text-decoration: none !important;
}
.shadow-1 {
  box-shadow: 0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23);
}
</style>
{% endblock css %}

{% block content %}
{{ block.super }}
<div class="container bg-white pt-3-xl px-0 shadow-1 mb-0 mb-xl-3">
  <form>
    <div class="input-group">
      <input type="text" class="form-control rounded-0 border-0" name="search_query" placeholder="Search e.g. pop_culture" maxlength="35" 
             pattern=".{0}|.{3,}" title="Empty or 3 characters minimum." value="{{ request.GET.search_query }}">
      <div class="input-group-btn">
        <button class="btn border-0 rounded-0 text-primary bg-white" type="submit">
          <span class="oi oi-magnifying-glass" title="Search" aria-hidden="true"></span>
        </button>
      </div>
      <div class="input-group-btn">
          <button class="btn border-0 rounded-0 text-primary bg-white" type="button" 
                  data-toggle="collapse" data-target="#filters" aria-expanded="false" aria-controls="filters">
            <span class="oi oi-cog" title="Filter" aria-hidden="true"></span>
          </button>
        </div>
    </div>
  </form> <!-- search form -->

  <div class="collapse" id="filters">
    <ul class="list-inline mb-0 py-3 text-center bg-primary">
    {% for difficulty in difficulties %}
      <li class="list-inline-item">
      {% if difficulty == filter_difficulty %}
        <a class="font-weight-bold text-white link-unstyled text-uppercase" href="?search_query={{ search_query }}">{{ difficulty.name }}</a>
      {% else %}
        <a class="text-white link-unstyled text-uppercase" href="?filter={{ difficulty.pk }}&search_query={{ search_query }}">{{ difficulty.name }}</a>
      {% endif %}
      </li>
    {% endfor %}
    </ul>
  </div> <!-- ./filters -->

  {% comment %}<p class="text-right mb-0"><a href="{% url "questions:create" %}">New Question</a></p>{% endcomment %}

  <ul class="list-group mb-3">
  {% for question in question_list %}
    {% with question.pk as answers_id %}
    <li data-toggle="collapse" href="#{{ answers_id }}" aria-expanded="false" aria-controls="{{ answers_id }}"
        class="list-group-item list-group-item-action flex-column align-items-start border-light rounded-0-i border-right-0 border-left-0">
      <div class="d-flex w-100 justify-content-between">
        <h5 class="mb-1 text-primary">{{ question.category }}</h5>
        <small class="text-muted">{{ question.difficulty }}</small>
      </div>
      <p class="mb-1">
        {{ question.text }}
        <span class="badge badge-primary">{{ question.answers.count }} answer{{ question.answers.count|pluralize }}</span>
      </p>
      <div class="collapse" id="{{ answers_id }}">
        <h6 class="text-primary">Answer{{ question.answers.count|pluralize }}</h5>
        <ol class="list-unstyled ml-3 mb-1">
        {% for answer in question.answers.all %}
          <li class="font-weight-bold">{{ answer }}</li>
        {% endfor %}
        </ol>
      </div>
      <div class="d-flex w-100 justify-content-between">
        <small class="text-muted">{{ question.created_on }}</small>
        <div class="dropdown">
          <a data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <span class="oi oi-ellipses text-primary" title="Search" aria-hidden="true"></span>
          </a>
          <div class="dropdown-menu">
            <span class="dropdown-item">
              <span class="oi oi-pencil" title="Search" aria-hidden="true"></span>
              Edit
            </span>
            <span class="dropdown-item">
              <span class="oi oi-plus" title="Search" aria-hidden="true"></span>
              Add to Question Set
            </span>
          </div> <!-- ./dropdown-menu -->
        </div> <!-- ./dropdown -->
      </div> <!-- ./d-flex -->
    </li> <!-- ./list-group-item -->
    {% endwith %}
  {% empty %}
    <p class="text-center pt-3 border border-left-0 border-right-0 border-bottom-0 border-light">No results found!</p>
  {% endfor %}
  </ul>
</div>
{% endblock content %}